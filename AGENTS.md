# AGENTS.md - AI Agent Instructions

This file contains important instructions and constraints for AI agents working on this codebase.

## Database Migrations

**CRITICAL: Always use drizzle-kit for database migrations. Never use Supabase CLI for migrations.**

### Migration Commands

```bash
# Generate migration from schema changes
npx drizzle-kit generate

# Apply pending migrations
npx drizzle-kit migrate

# Push schema directly (development only)
npx drizzle-kit push

# Open Drizzle Studio
npx drizzle-kit studio
```

### Migration Workflow

1. Modify the Drizzle schema in `backend/src/infrastructure/database/drizzle/schema.ts`
2. Run `npx drizzle-kit generate` to create migration SQL files
3. Review generated migrations in `backend/drizzle/`
4. Run `npx drizzle-kit migrate` to apply migrations

### Why Drizzle-Kit?

- Schema-first approach with TypeScript
- Type-safe migrations derived from Drizzle schema
- Consistent with our Drizzle ORM setup
- Better developer experience with Drizzle Studio

### What NOT to Use

Do NOT use these Supabase CLI commands for migrations:
- ❌ `supabase migration new`
- ❌ `supabase db reset`
- ❌ `supabase db push`

Supabase CLI is only used for:
- ✅ `supabase start` - Start local Supabase instance
- ✅ `supabase stop` - Stop local Supabase instance
- ✅ `supabase link` - Link to remote project
- ✅ Authentication and other Supabase services

## Project Structure

- **Backend**: `backend/` - Fastify API with Drizzle ORM
- **Frontend**: `frontend/` - React/Next.js application
- **Database Schema**: `backend/src/infrastructure/database/drizzle/schema.ts`
- **Drizzle Config**: `backend/drizzle.config.ts`
- **Migrations**: `backend/drizzle/` (generated by drizzle-kit)
