# Play Prediction Market

A binary prediction market platform built with React, Node.js, and Supabase.

## Project Structure

This is a monorepo containing:
- `backend`: Node.js Fastify API
- `frontend`: React app with TanStack Start
- `supabase`: Database and Auth configuration

## Prerequisites

- Node.js (v20+)
- npm (v10+)
- Supabase CLI (`npm i -g supabase`)
- Docker (required for Supabase local development)

## Setup

1. **Clone the repository**

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Environment Setup**
   Copy `.env.example` to `.env` and fill in the values.
   
   For local development, `supabase start` will generate the keys.

   ```bash
   cp .env.example .env
   ```

4. **Start Local Infrastructure**
   Start Supabase (Postgres, Auth, Realtime):
   ```bash
   npm run dev:db
   ```
   
   This command will output your API URL and keys. Update your `.env` file with these values if they differ from the defaults.

5. **Run Migrations**
   Initialize the database schema:
   ```bash
   npm run db:migrate
   ```

6. **Start Development Servers**
   Start all services (Backend, Frontend, Worker):
   ```bash
   npm run dev
   ```

   - Frontend: http://localhost:3000
   - Backend: http://localhost:4000
   - Supabase Studio: http://localhost:55323

7. **Background Jobs**
   The project uses BullMQ + Redis for background processing.
   Redis runs via Docker Compose (started automatically by `npm run dev` or manually via `npm run services:up`).

   **CLI Tools for Developers:**
   ```bash
   # Trigger a job manually
   npm run job:trigger --workspace=backend market-ops market:check-expired
   
   # View queue statistics
   npm run job:stats --workspace=backend
   
   # Clear a queue
   npm run job:clear --workspace=backend market-ops
   ```

## Available Scripts

- `npm run dev`: Start all services in development mode
- `npm run dev:db`: Start Supabase services
- `npm run dev:backend`: Start backend API only
- `npm run dev:frontend`: Start frontend only
- `npm run db:migrate`: Run database migrations
- `npm run db:studio`: Open Drizzle Studio for database management
- `npm run stop`: Stop Supabase services

## Environment Variables

| Variable | Description | Default (Local) |
|----------|-------------|-----------------|
| `SUPABASE_URL` | Supabase API URL | `http://127.0.0.1:55321` |
| `SUPABASE_ANON_KEY` | Public anonymous key | (Generated by CLI) |
| `SUPABASE_SERVICE_ROLE_KEY` | Private service role key | (Generated by CLI) |
| `DATABASE_URL` | PostgreSQL connection string | `postgresql://postgres:postgres@127.0.0.1:55326/postgres` |
| `REDIS_URL` | Redis connection URL | `redis://localhost:6379` |
